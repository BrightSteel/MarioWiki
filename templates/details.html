{% extends "base.html" %}

{% block css_links %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/details.css') }}">
{% endblock %}

{% block js_scripts %}
  <script src="{{ url_for('static', filename='js/details.js') }}"></script>
{% endblock %}

{% block title %}{{data.post_data.post_title}}{% endblock %}

{% block header %}
  <h1>Post details</h1>
{% endblock %}

{% block content %}
  <div class="pure-g">
    <div class="pure-u-1 pure-u-lg-1-5">
      <div id="content-left">
        <div class="blog">
          <div class="pic">
            <img src="{{ data.author_data.author_img }}" alt="User Image">
          </div>
          <div class="pure-g userinfo">
            <div class="username"><a id="side_author_link" href="{{ url_for('profile.get_profile_page', username=data.author_data.author_name) }}">{{ data.author_data.author_name }}</a></div>
            <div class="userpos">{{ data.author_data.author_post }} posts | {{data.author_data.author_fan}} followers</div>
            <div class="userbio">{{ data.author_data.author_bio| safe}}</div>
          </div>
        </div>
      </div>
    </div>

    <div class="pure-u-1 pure-u-lg-3-5">
      <div id="content-right-large" class="activities postbar">
        <h2 class="post-title">{{ data.post_data.post_title }}</h2>
        <div class="post_container" data-id="{{data.post_id}}">
          <p class="author-time">Author: <a id="author_link" href="{{ url_for('profile.get_profile_page', username=data.author_data.author_name) }}">{{ data.author_data.author_name }}</a> &nbsp;&nbsp;&nbsp;&nbsp; Created timeï¼š{{ data.post_data.post_time }}</p>
          {% if session.get("user") %}
            {% if session.get("user").get("userinfo").get("sub") == data.author_id%}
              <button class="pure-button" id="edit-btn">Edit Post</button>
              <button class="pure-button" id="delete-btn">Delete Post</button>
            {% endif %}
          {% endif %}
          <div id="inline_separator"></div>
          <form id="form{{data.post_id}}" method="post" style="display: none;">
            <input type="hidden" name="hidden" value="{{data.post_id}}">
            <input type="hidden" id="update{{data.post_id}}" name="update">
            <div id="editor{{data.post_id}}" style="height: 20vh;"></div>
            <button class="pure-button" id ="update-btn">Update</button>
            <button class="pure-button" type="button" id="cancel-btn">Cancel</button>
          </form>
          <p class="post_content">
            {{ data.post_data.post_content | safe}}
          </p>
        </div>
        <div id="post_separator"></div>
        {% if session.get("user") %}
          <div id="post_comment">
            <div style="margin-bottom: 4px">
              <span>Comment as {{session["user"]["userinfo"]["nickname"]}}</span>
            </div>
            <form id="comment-form" class="pure-form" action="{{ url_for('create_post.detail', post_id=data.post_data.post_id) }}" method="post">
              <div id="editor-post"></div>
              <input type="hidden" name="content" id="postData">
              <div id="post-btn">
                <button class="pure-button">Post</button>
              </div>
            </form>
          </div>
        {% else %}
          <div id="msg">
            <span>Wanna leave a comment? Please sign in ðŸ˜‰</span>
          </div>
        {% endif %}
        <div id="post_separator"></div>
        <div id="comment-header">
          <h4>Comments ({{ data.comments|length }})&nbsp;&nbsp;&nbsp;Likes&nbsp;
            <i id="like_button_{{data.post_id}}" class="like_button fa-regular fa-heart fa-lg"></i>
            <div class="button_like" data-id="{{data.post_id}}"></div>
            <!-- get the loading_url and error html-->
            <div id="loading-url" style="display:none">{{ loading_url }}</div>
            <div id="error-url" style="display:none">{{ error_url }}</div>
          </h4>
        </div>
        {% if data.comments | length != 0 %}
          <div id="post_separator"></div>
        {% endif %}
        {% for comment in data.comments %}
          <div id="post">
            <div id="post-author">
              <div class="pure-g">
                <div class="pure-u-1-9">
                  <img id="avatar_img" class="pure-img" src="{{comment[1][2]}}" alt="Avatar">
                </div>
                <div class="pure-u-1-9">
                  <h4 id="author_name"><a id="author_link" href="{{ url_for('profile.get_profile_page', username=comment[1][1]) }}">{{comment[1][1]}}</a></h4>
                </div>
                <div class="pure-u-1-9">
                  <p id="post_date">â€¢ {{comment[4]}}</p>
                </div>
              </div>
            </div>
            <div class="post-content">
              {{comment[3] |safe}}
            </div>
          </div>
          {% if comment != data.comments[-1] %}
            <div id="post_separator"></div>
          {% endif %}
        {% endfor %}
      </div>
    </div>

    <div class="pure-u-1 pure-u-lg-1-5">
      <div class="content-right">
        <div id="header">
          <div id="about">About category</div>
        </div>
        <div id="category" style="padding:12px">
          <div id="image_section">
            <img id="category_img" src="{{data.category_data.category_icon}}" alt="">
            <div>
              <a class="link-button" href="/categories/{{data.post_data.post_category}}">{{data.post_data.post_category | title}}</a>
            </div>
          </div>
          <div id="category_description">{{data.category_data.category_description}}</div>
          <div id="inline_separator"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="separator"></div>
{% endblock %}
